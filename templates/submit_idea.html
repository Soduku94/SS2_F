{% extends "base.html" %}

{% block title %}{{ title if title else "Submit New Research Idea" }}{% endblock %}

{% block body_attributes %}class="page-submit-idea-style-final"{% endblock %}

{% block content %}
<div class="container mt-4 mb-5 submit-idea-container-style-final">
    <div class="row justify-content-center">
        <div class="col-lg-9 col-md-11">
            <div class="submit-idea-form-wrapper-style-final p-4 p-md-5">
                <h2 class="mb-4 submit-idea-title-style-final text-center">{{ title if title else "Gửi Ý Tưởng Nghiên Cứu Mới" }}</h2>

                <form method="POST" action="{{ url_for('submit_idea') }}" novalidate enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    <fieldset>
                        <div class="mb-3">
                            {{ form.title.label(class="form-label submit-idea-label-style-final") }}
                            {{ form.title(class="form-control submit-idea-input-style-final" + (" is-invalid" if form.title.errors else ""), placeholder="Nhập tiêu đề ý tưởng của bạn") }}
                            {% if form.title.errors %}<div class="invalid-feedback">{% for error in form.title.errors %}<span>{{ error }}</span><br>{% endfor %}</div>{% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.description.label(class="form-label submit-idea-label-style-final") }}
                            <input type="hidden" name="description" id="idea_description_submit_style_final" value="{{ form.description.data or '' }}">
                            {# Thêm class submit-idea-input-style-final vào div bao ngoài Trix để CSS dễ áp dụng hơn #}
                            <div class="submit-idea-input-style-final submit-idea-trix-wrapper-style-final">
                                <trix-editor input="idea_description_submit_style_final" class="trix-content"></trix-editor>
                            </div>
                             {% if form.description.errors %}
                                <div class="invalid-feedback d-block">{% for error in form.description.errors %}<span>{{ error }}</span><br>{% endfor %}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.attachments.label(class="form-label submit-idea-label-style-final") }}
                            <div class="file-loading">
                                {{ form.attachments(class="file", multiple=True, id="ideaAttachmentInputStyleFinal", **{"data-browse-on-zone-click":"true"}) }}
                                {% if form.attachments.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.attachments.errors %}<span>{{ error }}</span><br>{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-4">
                            {{ form.recipients.label(class="form-label submit-idea-label-style-final") }}
                            {{ form.recipients(class="form-select submit-idea-input-style-final" + (" is-invalid" if form.recipients.errors else ""), size=5) }}
                            {% if form.recipients.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.recipients.errors %}<span>{{ error }}</span><br>{% endfor %}
                                </div>
                            {% endif %}
                             <small class="form-text submit-idea-form-text-style-final">Giữ Ctrl (hoặc Cmd trên Mac) và nhấp để chọn nhiều giảng viên. Mặc định không chọn ai sẽ gửi công khai cho tất cả giảng viên.</small>
                        </div>
                    </fieldset>

                    <div class="d-grid gap-2 mt-4">
                         {{ form.submit(class="btn submit-idea-submit-btn-style-final") }}
                    </div>
                </form>
                 <div class="mt-3 text-center">
                       <a href="{{ url_for('my_ideas') }}" class="submit-idea-back-link-style-final">Quay lại Danh sách Ý tưởng</a>
                  </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
$(document).ready(function() {
    $("#ideaAttachmentInputStyleFinal").fileinput({
        language: "en",
        theme: "bs5",
        showUpload: false,
        showCaption: true,
        showPreview: true,
        allowedFileExtensions: ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'pptx', 'png', 'jpg', 'jpeg', 'txt'],
        browseOnZoneClick: true,
        overwriteInitial: false,
        maxFileSize: 10240,
        maxFileCount: 5,
        dropZoneTitle: 'Drag & drop files here &hellip;',
        msgPlaceholder: 'Select files...',
        // Sử dụng class của Bootstrap hoặc class tùy chỉnh cho nút browse
        browseClass: "btn btn-light border submit-idea-krajee-browse-btn-style-final",
        // Các class để CSS nhắm mục tiêu các phần của Krajee
        dropZoneCssClass: 'submit-idea-dropzone-style-final',
        captionCssClass: 'submit-idea-file-caption-style-final' // Class cho vùng hiển thị tên file
    });
});
</script>
{% endblock %}