{% extends "base.html" %}

{% block title %}{{ title if title else "Submit New Research Idea" }}{% endblock %}

{% block body_attributes %}class="page-formpage-background"{% endblock %} {# Class chung cho body các trang form nếu muốn nền xám nhạt #}

{% block content %}
<div class="container mt-4 mb-5 formpage-container">
    <div class="row justify-content-center">
        <div class="col-lg-9 col-md-11"> {# Điều chỉnh độ rộng của khung form, ví dụ col-lg-9 rộng hơn chút #}
            <div class="formpage-wrapper-v2 p-4 p-md-5"> {# Class mới cho wrapper với style mới #}
                <h2 class="mb-4 formpage-title-v2 text-center">{{ title if title else "Gửi Ý Tưởng Nghiên Cứu Mới" }}</h2>

                <form method="POST" action="{{ url_for('submit_idea') }}" novalidate enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    <fieldset>
                        <div class="mb-3">
                            {{ form.title.label(class="form-label formpage-label-v2") }}
                            {{ form.title(class="form-control formpage-input-v2" + (" is-invalid" if form.title.errors else ""), placeholder="Nhập tiêu đề ý tưởng của bạn") }}
                            {% if form.title.errors %}<div class="invalid-feedback">{% for error in form.title.errors %}<span>{{ error }}</span><br>{% endfor %}</div>{% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.description.label(class="form-label formpage-label-v2") }}
                            <input type="hidden" name="description" id="idea_description_formpage_v2" value="{{ form.description.data or '' }}">
                            <trix-editor input="idea_description_formpage_v2" class="form-control trix-content formpage-trix-v2"></trix-editor>
                             {% if form.description.errors %}
                                <div class="invalid-feedback d-block">{% for error in form.description.errors %}<span>{{ error }}</span><br>{% endfor %}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.attachments.label(class="form-label formpage-label-v2") }}
                            <div class="file-loading">
                                {{ form.attachments(class="file formpage-file-input-v2", multiple=True, id="ideaAttachmentInputFormpageV2", **{"data-browse-on-zone-click":"true"}) }}
                                {% if form.attachments.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.attachments.errors %}<span>{{ error }}</span><br>{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-4">
                            {{ form.recipients.label(class="form-label formpage-label-v2") }}
                            {{ form.recipients(class="form-select formpage-input-v2" + (" is-invalid" if form.recipients.errors else ""), size=5) }}
                            {% if form.recipients.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.recipients.errors %}<span>{{ error }}</span><br>{% endfor %}
                                </div>
                            {% endif %}
                             <small class="form-text formpage-form-text-v2">Giữ Ctrl (hoặc Cmd trên Mac) và nhấp để chọn nhiều giảng viên. Mặc định không chọn ai sẽ gửi công khai cho tất cả giảng viên.</small>
                        </div>
                    </fieldset>

                    <div class="d-grid gap-2 mt-4">
                         {{ form.submit(class="btn formpage-submit-btn-v2") }} {# Value từ forms.py #}
                    </div>
                </form>
                 <div class="mt-3 text-center">
                       <a href="{{ url_for('my_ideas') }}" class="formpage-back-link-v2">Quay lại Danh sách Ý tưởng</a>
                  </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
$(document).ready(function() {
    $("#ideaAttachmentInputFormpageV2").fileinput({ // ID mới
        language: "en", // Hoặc "vi"
        theme: "bs5",
        showUpload: false,
        showCaption: true, // Hiện input "Select files..."
        showPreview: true,
        allowedFileExtensions: ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'pptx', 'png', 'jpg', 'jpeg', 'txt'],
        browseOnZoneClick: true,
        overwriteInitial: false,
        maxFileSize: 10240, // 10MB
        maxFileCount: 5,
        dropZoneTitle: 'Drag & drop files here &hellip;',
        msgPlaceholder: 'Select files...', // Chữ trong input tên file khi chưa chọn
        // Class cho nút browse để style nền trắng, chữ đen
        browseClass: "btn btn-light border formpage-krajee-browse-btn-v2",
    });
});
</script>
{% endblock %}