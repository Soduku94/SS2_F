{% extends "base.html" %}
{% block title %}Account Information{% endblock %}

{% block content %}
<div class="row mt-4 gy-4"> {# Added gy-4 for vertical spacing between columns on mobile #}

    {# --- Information Display Column (Left) --- #}
    <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
            <div class="card-body text-center">
                {# === LOGIC TO DETERMINE URL AND DISPLAY PROFILE PICTURE (CORRECT) === #}
                {# 1. Get filename from DB, use default.jpg if none #}
                {% set image_filename = current_user.image_file if current_user.image_file else 'default.jpg' %}
                {# 2. Default folder is user_pics #}
                {% set image_folder = 'user_pics' %}
                {# 3. CHECK: If filename IS default -> Change to profile_pics folder #}
                {% if image_filename.startswith('default') %}
                    {% set image_folder = 'profile_pics' %} {# Change folder #}
                    {# Select specific default image based on gender #}
                    {% if current_user.gender == 'female' %}
                        {% set image_filename = 'default_female.jpg' %}
                    {% elif current_user.gender == 'male' %}
                         {% set image_filename = 'default_male.jpg' %}
                    {% else %}
                         {% set image_filename = 'default.jpg' %} {# Fallback #}
                    {% endif %}
                {% endif %} {# End default check #}
                {# 4. Create final URL #}
                {% set avatar_url = url_for('static', filename=image_folder + '/' + image_filename) %}
                {# === END LOGIC === #}

                {# 5. Display image #}
                <img class="rounded-circle img-thumbnail mb-3" src="{{ avatar_url }}" alt="Profile Picture" width="180" height="180" style="object-fit: cover;">

                <h4 class="mb-1">{{ current_user.full_name }}</h4>
                {% if current_user.role == 'student' and current_user.class_name %}
                    <p class="text-muted mb-0">{{ current_user.class_name }}</p>
                {% elif current_user.role == 'lecturer' %}
                     <p class="text-muted mb-0">Lecturer</p>
                {% endif %}
            </div>
        </div>
    </div>

    {# --- Detailed Information Column (Right) --- #}
    <div class="col-lg-8">
        <div class="card shadow-sm">
             <div class="card-header">
                 <h5 class="mb-0">Detailed Information</h5>
             </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Full Name:</dt>
                    <dd class="col-sm-8">{{ current_user.full_name }}</dd>

                    <dt class="col-sm-4">Role:</dt>
                    <dd class="col-sm-8">
                         {% if current_user.role == 'lecturer' %} <span class="badge bg-primary">Lecturer</span>
                         {% elif current_user.role == 'student' %} <span class="badge bg-info">Student</span>
                         {% else %} <span class="badge bg-danger">Admin</span>
                         {% endif %}
                    </dd>

                    {% if current_user.role == 'student' %}
                        <dt class="col-sm-4">Student ID:</dt>
                        <dd class="col-sm-8">{{ current_user.student_id or 'Not updated yet' }}</dd>
                        <dt class="col-sm-4">Class:</dt>
                        <dd class="col-sm-8">{{ current_user.class_name or 'Not updated yet' }}</dd>
                        <dt class="col-sm-4">Cohort:</dt> {# "Cohort" or "Academic Year" or "Intake" #}
                        <dd class="col-sm-8">{{ cohort or 'N/A' }}</dd>
                    {% endif %}

                    <dt class="col-sm-4">Login Email:</dt>
                    <dd class="col-sm-8">{{ current_user.email }} </dd>

                    <dt class="col-sm-4">Date of Birth:</dt>
                    <dd class="col-sm-8">{{ current_user.date_of_birth.strftime('%d/%m/%Y') if current_user.date_of_birth else 'Not updated yet' }}</dd>

                    <dt class="col-sm-4">Gender:</dt>
                    <dd class="col-sm-8">
                        {% if current_user.gender == 'male' %} Male
                        {% elif current_user.gender == 'female' %} Female
                        {% else %} Not updated yet
                        {% endif %}
                     </dd>

                     <dt class="col-sm-4">Phone:</dt>
                     <dd class="col-sm-8">{{ current_user.phone_number or 'Not updated yet' }}</dd>

                     <dt class="col-sm-4">Alternative Contact Email:</dt>
                     <dd class="col-sm-8">{{ current_user.contact_email or 'Not updated yet' }}</dd>

                </dl>

                <h6>About Me:</h6>
                {% if current_user.about_me %}
                     <p class="text-muted small" style="white-space: pre-wrap;">{{ current_user.about_me }}</p>
                {% else %}
                     <p class="text-muted small"><i>Not updated yet...</i></p>
                {% endif %}

                 {# --- Action Buttons --- #}
                 <hr>
                 <div class="text-end d-flex justify-content-end align-items-center">
                     <a href="{{ url_for('change_password') }}" class="btn btn-outline-secondary me-2">
                         <i class="bi bi-key-fill"></i> Change Password
                     </a>
                     <a href="{{ url_for('account_edit') }}" class="btn btn-primary">
                         <i class="bi bi-pencil-square"></i> Edit Information
                     </a>
                 </div>
            </div> {# End card-body #}
        </div> {# End card #}
    </div> {# End col-lg-8 #}
</div> {# End row #}
{% endblock %}